<head>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
</head>

<script>

var active_form = "zaznam";

window.onload = function() {

    document.getElementById('Date').value = new Date().toJSON().slice(0,10);
    document.getElementById('tank_date').value = new Date().toJSON().slice(0,10);

    switchForms();

    sheetsNames.forEach(function(element){
        var option = document.createElement("option");
        option.text = element; option.value = element;
        document.getElementById('tank_carname').add(option);
        option = document.createElement("option");
        option.text = element; option.value = element;
        document.getElementById('fill_carname').add(option);
    })

}

function onSuccess() {

    document.getElementById("statusbar").innerHTML = 'Dokončuji';

    var carname = document.getElementById('add_carname').value;
    if (carname) {
        var option = document.createElement("option");
        option.text = carname; option.value = carname;
        document.getElementById('fill_carname').append(option);
        option = document.createElement("option");
        option.text = carname; option.value = carname;
        document.getElementById('tank_carname').append(option);
    }

    var deleteThese = [
        'fill_carname', 'add_carname', 'trasa_odkud','trasa_pres','trasa_kam','trasa_sofer',
        'tank_sofer', 'tank_km', 'tank_l', 'tank_price', 'tank_note',
        'trasa_poznamka','km_konecny','km_kilometru','add_user','add_owner','add_pocatecni',
    ]
    deleteThese.forEach(element => vymazat(element));

    if(document.getElementById('fill_carname')) document.getElementById('fill_carname').value = "Vyber uživatele";
    if(document.getElementById('tank_carname')) document.getElementById('tank_carname').value = "Vyber uživatele";

    document.getElementById("statusbar").innerHTML = 'Úspěšně odesláno. :)';
    document.getElementById("statusbar").className = "alert alert-success";
}

function onFailure() {
    document.getElementById("statusbar").innerHTML="Chyba! Obnov stránku";
    document.getElementById("statusbar").className = "alert alert-danger";
}

function newZaznam(hard = 0) {

    var val = {
             type: document.getElementById('trasa_typ').value,
             date: document.getElementById('Date').value,
          carname: document.getElementById('fill_carname').value,
           driver: document.getElementById('trasa_sofer').value,
            odkud: document.getElementById('trasa_odkud').value,
             pres: document.getElementById('trasa_pres').value,
              kam: document.getElementById('trasa_kam').value,
          konecny: document.getElementById('km_konecny').value,
        kilometru: document.getElementById('km_kilometru').value,
             note: document.getElementById('trasa_poznamka').value,
    }

    var warningText = "";
    if (val.carname == "Vyber uživatele" || !val.carname) {warningText += "\nNení vybrán uživatel"; }
    if (val.konecny && val.kilometru) {warningText += '\nNelze vyplnit kilometry a konečný stav zároveň'; }
    if (!val.konecny && !val.kilometru) {warningText += "\nNejsou vyplněné kilometry"; }
    if (warningText.length != 0 && !hard) {alert(warningText); return; }

    google.script.run
        .withSuccessHandler(onSuccess)
        .withFailureHandler(onFailure)
        .fillIn(val);
}
function newCar() {

    var val = {
        action: "addNewCar",
         owner: document.getElementById('add_owner').value,
          name: document.getElementById('add_carname').value,
          user: document.getElementById('add_user').value,
          date: new Date().toJSON().slice(0,10),
            km: document.getElementById('add_pocatecni').value,
    };

    google.script.run
        .withSuccessHandler(onSuccess)
        .withFailureHandler(onFailure)
        .registerCar(val);

}
function newTank(hard = 0) {

    var val = {
        action: tank_action_name,
        driver: document.getElementById('tank_sofer').value,
         price: document.getElementById('tank_price').value,
          date: document.getElementById('tank_date').value,
          name: document.getElementById('tank_carname').value,
          note: document.getElementById('tank_note').value,
            km: document.getElementById('tank_km').value,
             l: document.getElementById('tank_l').value,
    }

    google.script.run
        .withSuccessHandler(onSuccess)
        .withFailureHandler(onFailure)
        .tankCar(val);

}

function submitData(hard = 0) {

    document.getElementById("statusbar").innerHTML="Odesílám, čekej"
    document.getElementById("statusbar").className = "alert alert-warning";

    switch (active_form) {
        case "zaznam":    newZaznam(hard); break;
        case tank_action_name: newTank(hard);   break;
        case "pridat":    newCar(hard);    break;
    }
}

function switchForms(form = "zaznam") {

    active_form = form;

    switch (form) {
        case "zaznam":
            document.getElementById("form_zaznam").style.display = "block";
            document.getElementById("button_zaznam").className = "btn btn-success";
            document.getElementById("form_pridat").style.display =  "none";
            document.getElementById("button_pridat").className = "btn btn-secondary";
            document.getElementById("form_tankovani").style.display =  "none";
            document.getElementById("button_tankovani").className = "btn btn-secondary";
        break;
        case tank_action_name:
            document.getElementById("form_zaznam").style.display =  "none";
            document.getElementById("button_zaznam").className = "btn btn-secondary";
            document.getElementById("form_pridat").style.display = "none";
            document.getElementById("button_pridat").className = "btn btn-secondary";
            document.getElementById("form_tankovani").style.display =  "block";
            document.getElementById("button_tankovani").className = "btn btn-success";
        break;
        case "pridat":
            document.getElementById("form_zaznam").style.display =  "none";
            document.getElementById("button_zaznam").className = "btn btn-secondary";
            document.getElementById("form_pridat").style.display = "block";
            document.getElementById("button_pridat").className = "btn btn-success";
            document.getElementById("form_tankovani").style.display =  "none";
            document.getElementById("button_tankovani").className = "btn btn-secondary";
        break;
    }

}

function vymazat(_pole) {
    if (document.getElementById(_pole).value) {
        document.getElementById(_pole).value = '';
    }
}

</script>

<body>

<datalist id="uzivatele_aut">
    <option value="Luboš Hubáček">
    <option value="Dominik">
    <option value="Milan">
    <option value="Další se dají přidat">
</datalist>

<datalist id="znama_mesta">
    <option value="Litice">
    <option value="Praha">
    <option value="Doubravka">
    <option value="Plzeň">
    <option value="Habrmannovo náměstí">
    <option value="Další se dají přidat">
</datalist>

<div style="width: 350px; margin: auto;">
    <div class="alert alert-info" role="alert" id="statusbar" style="text-align: center;">Zapiš</div>

    <div class="btn-group" role="group" style="width: 100%">
        <button type="button" class="btn btn-success" onclick='switchForms("zaznam")' id="button_zaznam">Jízda</button>
        <button type="button" class="btn btn-secondary" onclick='switchForms(tank_action_name)' id="button_tankovani">Tankovat</button>
        <button type="button" class="btn btn-secondary" onclick='switchForms("pridat")' id="button_pridat">Registrace</button>
    </div>

    <form id="form_zaznam" style="display: block;">

        <div class="input-group">
            <div class="input-group-prepend"><span class="input-group-text" style="width: 100px;">Auto</span></div>
            <select class="custom-select" id="fill_carname" style="width: 100%; text-align: center;">
                <option selected>Vyber uživatele</option>
            </select>
        </div>

        <div class="input-group">
            <div class="input-group-prepend"><span class="input-group-text" style="width: 100px">Odkud</span></div>
            <input type="text" class="form-control" id="trasa_odkud" style="max-width: 250px" list="znama_mesta">
        </div>

        <div class="input-group">
            <div class="input-group-prepend"><span class="input-group-text" style="width: 100px">Přes</span></div>
            <input type="text" class="form-control" id="trasa_pres" style="max-width: 250px" list="znama_mesta">
        </div>

        <div class="input-group">
            <div class="input-group-prepend"><span class="input-group-text" style="width: 100px">Kam</span></div>
            <input type="text" class="form-control" id="trasa_kam" style="max-width: 250px" list="znama_mesta">
        </div>

        <div class="input-group">
            <div class="input-group-prepend"><span class="input-group-text" style="width: 100px">Typ</span></div>
            <select class="custom-select" id="trasa_typ" style="width: 100%; text-align: center;">
                <option value="Osobní">Osobní</option><option value="Služební">Služební</option>
            </select>
        </div>

        <div class="input-group">
            <div class="input-group-prepend"><span class="input-group-text" style="width: 100px">Šofér</span></div>
            <input type="text" class="form-control" id="trasa_sofer" style="max-width: 250px" list="uzivatele_aut">
        </div>

        <div class="input-group">
            <div class="input-group-prepend"><span class="input-group-text" style="width: 100px">Konečný</span></div>
            <input type="number" class="form-control" id="km_konecny" style="max-width: 250px">
        </div>

        <div class="input-group">
            <div class="input-group-prepend"><span class="input-group-text" style="width: 100px">Kilometrů</span></div>
            <input type="number" class="form-control" id="km_kilometru" style="max-width: 250px">
        </div>

        <div class="input-group">
            <div class="input-group-prepend"><span class="input-group-text" style="width: 100px">Poznámka</span></div>
            <textarea rows="1" class="form-control" id="trasa_poznamka" style="max-width: 250px"></textarea>
        </div>

        <div class="input-group">
            <div class="input-group-prepend">
                <span class="input-group-text" style="width: 100px">Datum</span>
            </div>
            <input type="date" class="form-control" id="Date" style="max-width: 250px; text-align: center;">
        </div>

    </form>

    <form id="form_tankovani" style="display: none;">

        <div class="input-group">
            <div class="input-group-prepend"><span class="input-group-text" style="width: 100px;">Auto</span></div>
            <select class="custom-select" id="tank_carname" style="width: 100%; text-align: center;">
                <option selected>Vyber uživatele</option>
            </select>
        </div>

        <div class="input-group">
            <div class="input-group-prepend"><span class="input-group-text" style="width: 100px">Šofér</span></div>
            <input type="text" class="form-control" id="tank_sofer" style="max-width: 250px" list="uzivatele_aut">
        </div>

        <div class="input-group">
            <div class="input-group-prepend"><span class="input-group-text" style="width: 100px">Kilometry</span></div>
            <input type="number" class="form-control" id="tank_km" style="max-width: 250px">
        </div>

        <div class="input-group">
            <div class="input-group-prepend"><span class="input-group-text" style="width: 100px">Litry</span></div>
            <input type="number" class="form-control" id="tank_l" style="max-width: 250px">
        </div>

        <div class="input-group">
            <div class="input-group-prepend"><span class="input-group-text" style="width: 100px">Cena</span></div>
            <input type="number" class="form-control" id="tank_price" style="max-width: 250px">
        </div>

        <div class="input-group">
            <div class="input-group-prepend"><span class="input-group-text" style="width: 100px">Poznámka</span></div>
            <textarea rows="1" class="form-control" id="tank_note" style="max-width: 250px"></textarea>
        </div>

        <div class="input-group">
            <div class="input-group-prepend">
                <span class="input-group-text" style="width: 100px">Datum</span>
            </div>
            <input type="date" class="form-control" id="tank_date" style="max-width: 250px; text-align: center;">
        </div>

    </form>

    <form id="form_pridat" style="display: none;">

        <div class="input-group">
            <div class="input-group-prepend"><span class="input-group-text" style="width: 100px">Auto</span></div>
            <input type="text" class="form-control" id="add_carname" style="max-width: 250px" placeholder="Název auta">
        </div>

        <div class="input-group">
            <div class="input-group-prepend"><span class="input-group-text" style="width: 100px">Vlastník</span></div>
            <input type="text" class="form-control" id="add_owner" style="max-width: 250px" placeholder="Majitel auta">
        </div>

        <div class="input-group">
            <div class="input-group-prepend"><span class="input-group-text" style="width: 100px">Uživatel</span></div>
            <input type="text" class="form-control" id="add_user" style="max-width: 250px" placeholder="Zodpovědná osoba" list="uzivatele_aut">
        </div>

        <div class="input-group">
            <div class="input-group-prepend"><span class="input-group-text" style="width: 100px">Stav</span></div>
            <input type="number" class="form-control" id="add_pocatecni" style="max-width: 250px" placeholder="Stav tachometru">
        </div>

    </form>

    <div class="btn-group" role="group" style="width: 100%">
        <button type="button" class="btn btn-primary" onclick='submitData()' >Potvrdit ! :) </button>
    </div>

</div>

</body>
